From e8663fb525b5e34f9a4c5ece5cecf82304e2f975 Mon Sep 17 00:00:00 2001
From: Ji Bin <matrixji@live.com>
Date: Sun, 5 Nov 2023 18:27:32 +0800
Subject: [PATCH] fix for gettid

Signed-off-by: Ji Bin <matrixji@live.com>
---
 include/knowhere/comp/thread_pool.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/include/knowhere/comp/thread_pool.h b/include/knowhere/comp/thread_pool.h
index 29d1eb6..895ec53 100644
--- a/include/knowhere/comp/thread_pool.h
+++ b/include/knowhere/comp/thread_pool.h
@@ -13,6 +13,7 @@
 
 #include <omp.h>
 #include <sys/resource.h>
+#include <sys/syscall.h>
 
 #include <cerrno>
 #include <cstring>
@@ -39,7 +40,7 @@ class ThreadPool {
         std::thread
         newThread(folly::Func&& func) override {
             return folly::NamedThreadFactory::newThread([&, func = std::move(func)]() mutable {
-                if (setpriority(PRIO_PROCESS, gettid(), 19) != 0) {
+                if (setpriority(PRIO_PROCESS, syscall(SYS_gettid), 19) != 0) {
                     LOG_KNOWHERE_ERROR_ << "Failed to set priority of knowhere thread. Error is: "
                                         << std::strerror(errno);
                 } else {
-- 
2.43.0

